import{d as V,aQ as A,u as F,aR as I,aS as j,r as v,o as M,c as e,b as o,aT as N,a as d,F as O,aU as P,B as S,aV as w,aW as L,S as R,e as K,i as Q}from"./index-DWdSJ7w-.js";import{B as b,a as U}from"./BasicTopBar-DaLsAjcI.js";import{D as W,a as q}from"./DeckerLayout-ClntHTTW.js";import{d as z}from"./vue-utils-BE5oyP_w.js";import"./useTRouter-4TIHd1D3.js";const E="_settings_u1gk8_1",G="_list_u1gk8_1",H="_catogory_u1gk8_6",J="_item_u1gk8_12",X="_label_u1gk8_23",Y="_value_u1gk8_29",Z="_control_u1gk8_38",l={settings:E,list:G,catogory:H,item:J,label:X,value:Y,control:Z};function C(i){return typeof i=="function"||Object.prototype.toString.call(i)==="[object Object]"&&!Q(i)}const le=V({name:"Settings",setup(){const{updateSettingMap:i}=A(),{t:a}=F({useScope:"global"}),f=I(),D=j(),p=v([]),r=v(),u=v(),y=()=>Promise.all(N.map(s=>d.settings.getSettingsByCategory(s))).then(s=>{p.value=s});M(()=>{y()});const _=s=>{const{key:n,value:c}=s;return d.settings.updateSettingByKey(n,c).then(()=>{f.success(a("pages.settings.decker.topbar.saveSuccess")),i(n,c)}).catch(()=>{f.error(a("pages.settings.decker.topbar.saveFailed")),y()})},B=s=>{let n,c;if(console.log(u),u.value===void 0||r.value===void 0)return s(),e(O,null,null);const t=u.value,m=v();return P(t,g=>{t.value=g}).then(g=>{m.value=g}),e(q,{topBar:e(b,{leftSlots:[e(S,{text:!0,onClick:s},C(n=a("common.cancel"))?n:{default:()=>[n]})],rightSlots:[e(S,{text:!0,type:"primary",onClick:()=>{const{key:g}=t,k=p.value[r.value],x=k.findIndex(T=>T.key===g);k.splice(x,1,t),p.value.splice(r.value,1,k),_(t).finally(()=>{u.value=void 0,r.value=void 0,s()})}},C(c=a("common.save"))?c:{default:()=>[c]})]},null)},{default:()=>[e("div",{class:l.control},[e("div",null,[a(t.label)]),m.value])]})},h=s=>e(U,{topBar:e(b,null,{default:()=>[e(R,{name:"setting"},null),K(" "),a("pages.settings.topbar.title")]})},{default:()=>[e("h2",null,[a("pages.settings.topbar.title")]),e("ul",{class:o(l.list)},[p.value.map((n,c)=>e("div",{class:o(l.catogory)},[n.filter(t=>!t.hidden).map(t=>e("li",{key:t.key,class:o(l.item),onClick:()=>{w(t)&&(r.value=c,u.value=z(t),s())}},[e("span",{class:o(l.label)},[a(t.label)]),e("span",{class:o(l.value)},[L(t,m=>{t.value=m,_(t)})])]))])),e("div",{class:o(l.catogory)},[e("li",{class:o(l.item),onClick:()=>{D.warning({title:a("pages.settings.clearData.confirmDialog.title"),content:a("pages.settings.clearData.confirmDialog.content"),positiveText:a("common.yes"),negativeText:a("common.thinkAgain"),closable:!1,maskClosable:!1,onPositiveClick(){Promise.all([d.book.clearAllBooks(),d.bookcase.clearAllBookcases(),d.settings.clearAllSettings()]).then(()=>{f.success(a("pages.settings.clearData.confirmDialog.clearFinished")),setTimeout(()=>{location.replace("./")},700)})}})}},[e("span",{class:o(l.label)},[a("pages.settings.clearData.label")]),e("span",{class:o(l.value)},null)])])])]});return()=>e(W,{class:o(l.settings),maskClosable:!1},{default:h,decker:B})}});export{le as default};
//# sourceMappingURL=Settings-CC6nM4kY.js.map
