import{d as D,u as B,f as h,c as e,b as n,a as g,aQ as I,r as f,o as N,aR as V,F as j,aS as O,B as S,aT as P,aU as w,S as L,e as M,i as R}from"./index-30hCGXPD.js";import{B as _,a as K}from"./BasicTopBar-DZ2A2u97.js";import{D as Q,a as U}from"./DeckerLayout-B-Ge_Jmh.js";import{d as q}from"./vue-utils-B-nIgjt6.js";import"./useTRouter-Dz1NFglY.js";const z="_settings_u1gk8_1",E="_list_u1gk8_1",G="_catogory_u1gk8_6",H="_item_u1gk8_12",J="_label_u1gk8_23",W="_value_u1gk8_29",X="_control_u1gk8_38",l={settings:z,list:E,catogory:G,item:H,label:J,value:W,control:X},Y=D({name:"ClearData",setup(){const{t:a}=B({useScope:"global"}),{dialog:o,message:d}=h();return()=>e("li",{class:n(l.item),onClick:()=>{o.warning({title:a("pages.settings.clearData.confirmDialog.title"),content:a("pages.settings.clearData.confirmDialog.content"),positiveText:a("common.yes"),negativeText:a("common.thinkAgain"),closable:!1,maskClosable:!1,onPositiveClick(){Promise.all([g.book.clearAllBooks(),g.bookcase.clearAllBookcases(),g.settings.clearAllSettings()]).then(()=>{d.success(a("pages.settings.clearData.confirmDialog.clearFinished")),setTimeout(()=>{location.replace("./")},700)})}})}},[e("span",{class:n(l.label)},[a("pages.settings.clearData.label")]),e("span",{class:n(l.value)},null)])}});function C(a){return typeof a=="function"||Object.prototype.toString.call(a)==="[object Object]"&&!R(a)}const se=D({name:"Settings",setup(){const{updateSettingMap:a}=I(),{t:o}=B({useScope:"global"}),{message:d}=h(),p=f([]),u=f(),m=f(),y=()=>Promise.all(V.map(s=>g.settings.getSettingsByCategory(s))).then(s=>{p.value=s});N(()=>{y()});const b=s=>{const{key:c,value:i}=s;return g.settings.updateSettingByKey(c,i).then(()=>{d.success(o("pages.settings.decker.topbar.saveSuccess")),a(c,i)}).catch(()=>{d.error(o("pages.settings.decker.topbar.saveFailed")),y()})},x=s=>{let c,i;if(m.value===void 0||u.value===void 0)return s(),e(j,null,null);const t=m.value,v=f();return O(t,r=>{t.value=r}).then(r=>{v.value=r,console.log(r)}),e(U,{topBar:e(_,{leftSlots:[e(S,{text:!0,onClick:s},C(c=o("common.cancel"))?c:{default:()=>[c]})],rightSlots:[e(S,{text:!0,type:"primary",onClick:()=>{const{key:r}=t,k=p.value[u.value],F=k.findIndex(A=>A.key===r);k.splice(F,1,t),p.value.splice(u.value,1,k),b(t).finally(()=>{m.value=void 0,u.value=void 0,s()})}},C(i=o("common.save"))?i:{default:()=>[i]})]},null)},{default:()=>[e("div",{class:l.control},[e("div",null,[o(t.label)]),v.value])]})},T=s=>e(K,{topBar:e(_,null,{default:()=>[e(L,{name:"setting"},null),M(" "),o("pages.settings.topbar.title")]})},{default:()=>[e("h2",null,[o("pages.settings.topbar.title")]),e("ul",{class:n(l.list)},[p.value.map((c,i)=>e("div",{class:n(l.catogory)},[c.filter(t=>!t.hidden).map(t=>e("li",{key:t.key,class:n(l.item),onClick:()=>{P(t)&&(u.value=i,m.value=q(t),s())}},[e("span",{class:n(l.label)},[o(t.label)]),e("span",{class:n(l.value)},[w(t,v=>{t.value=v,b(t)})])]))])),e("div",{class:n(l.catogory)},[e(Y,null,null)])])]});return()=>e(Q,{class:n(l.settings),maskClosable:!1},{default:T,decker:x})}});export{se as default};
//# sourceMappingURL=Settings-BVJQSBJS.js.map
