<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>WebAssembly 基础（二） | Yangholmes' blog</title>
    <meta name="description" content="Yangholmes' blog">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.DriXcPjx.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.BtoqWO6q.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.Cc4yYURl.js">
    <link rel="modulepreload" href="/assets/chunks/theme.CnSLk86F.js">
    <link rel="modulepreload" href="/assets/chunks/katex.ChWnQ-fc.js">
    <link rel="modulepreload" href="/assets/chunks/dagre-JOIXM2OF.IEQEM4xm.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-6F6E4RAY.CYTC54v5.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-KYDEHFYC.9x94zvb4.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-3M52JZNH.Dgs90lu3.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-GW3U2K7C.DtLF0C40.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-EK5VF46D.Bd-9o-Hu.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-LHK5PUON.BjHK2sst.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-NIOCPIFQ.1P49c5IS.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-2OG54O6I.Be8VtmTO.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-H2YORKM3.cAhVpqIA.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-QOLK2EJ7.D0WZKLr-.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-SKLFT4DO.U-pGv2zB.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-M3E45YP4.B8D5s8vI.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-YAWTLIQI.B8D5s8vI.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-MI5ZYTHO.YHHL-lOl.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-5AN5P6BG.BJ2IcgJD.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-EWQZEKCU.DIZEsA_M.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-MYPXXCX6.B1u2z0Dv.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-6CBA2TL7.BO6Ofbyh.js">
    <link rel="modulepreload" href="/assets/chunks/kanban-definition-ZSS6B67P.D4lRCzR1.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-4UZDY2LN.CP7oqtn8.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-5UYTHUR4.DqikicY3.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-ZTM2IBQH.D7_He2XN.js">
    <link rel="modulepreload" href="/assets/chunks/blockDiagram-6J76NXCF.CaLQjiDf.js">
    <link rel="modulepreload" href="/assets/chunks/architectureDiagram-SUXI7LT5.D9TIcWDO.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-VMROVX33.DAYkygYY.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/assets/技术的小记_WebAssembly 基础（二）_index.md.54W5oS0Y.lean.js">
    <link rel="icon" type="image/x-icon" href="/icon.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta property="og:title" content="WebAssembly 基础（二）">
    <meta property="og:description" content="WebAssembly 基础（二）">
    <meta property="og:type" content="website">
    <meta property="og:image" content="">
  </head>
  <body><!--teleport start anchor--><div class="overlay" data-v-2a3b9918></div><!--teleport anchor-->
    <div id="app"><div class="main-layout" data-v-4a448231><div class="left-side" data-v-4a448231><div class="sidebar" data-v-4a448231 data-v-2a3b9918><div class="mobile-only handler" data-v-2a3b9918 data-v-ca29c581 data-v-80979bf7><!--[--><div class="toggle-handler" data-v-ca29c581><span class="vpi-chevron-right icon" data-v-ca29c581></span></div><!--]--></div><div class="top-bar" data-v-2a3b9918><div class="theme-switch is-dark" data-v-2a3b9918 data-v-6427e52d><div class="round-button switch sun" data-v-6427e52d data-v-d3afb744><span class="vpi-sun icon" data-v-d3afb744></span></div><div class="round-button switch moon" data-v-6427e52d data-v-d3afb744><span class="vpi-moon icon" data-v-d3afb744></span></div></div><div class="VPNavBarSearch plugin search" data-v-2a3b9918 data-v-d17e8928><!----><div id="docsearch"><!--[--><div class="round-button" data-v-d17e8928 data-v-d3afb744><span class="vpi-search icon" data-v-d3afb744></span></div><!--]--></div></div></div><nav data-v-2a3b9918><div class="avatar" data-v-2a3b9918 data-v-d3b92462><a href="/" data-v-d3b92462><div class="image" style="--image: url(/assets/cats.BfteQRM1.png)" data-v-d3b92462></div></a><p data-v-d3b92462>Yangholmes</p><p data-v-d3b92462> 邋遢和小松的 <ruby data-v-d3b92462>铲<rt data-v-d3b92462>chǎn</rt></ruby><ruby data-v-d3b92462>屎<rt data-v-d3b92462>shǐ</rt></ruby><ruby data-v-d3b92462>官<rt data-v-d3b92462>guān</rt></ruby></p></div><ul class="category-list" data-v-2a3b9918><!--[--><li class="active" data-v-2a3b9918><a href="/技术的小记/" data-v-2a3b9918>技术的小记</a></li><li class="" data-v-2a3b9918><a href="/派的玩耍小记/" data-v-2a3b9918>派的玩耍小记</a></li><li class="" data-v-2a3b9918><a href="/生活咏叹调/" data-v-2a3b9918>生活咏叹调</a></li><!--]--></ul><ul class="socials" data-v-2a3b9918 data-v-fb1a9594><!--[--><li data-v-fb1a9594><a href="https://github.com/Yangholmes" target="_blank" rel="noopener noreferrer" data-v-fb1a9594><div class="social-icon" style="--mask-image: "></div></a></li><li data-v-fb1a9594><a href="https://dev.to/yangholmes" target="_blank" rel="noopener noreferrer" data-v-fb1a9594><div class="social-icon" style="--mask-image: "></div></a></li><li data-v-fb1a9594><a href="https://www.instagram.com/yangholmes/" target="_blank" rel="noopener noreferrer" data-v-fb1a9594><div class="social-icon" style="--mask-image: "></div></a></li><li data-v-fb1a9594><a href="/wechat-qrcode.png" target="_blank" rel="noopener noreferrer" data-v-fb1a9594><div class="social-icon" style="--mask-image: "></div></a></li><!--]--></ul></nav><div class="bottom-bar" data-v-2a3b9918></div><!--teleport start--><!--teleport end--></div></div><main class="content" data-v-4a448231><div class="nav-bar" data-v-4a448231 data-v-df838852><div class="round-button" data-v-df838852 data-v-d3afb744><span class="vpi-arrow-left icon" data-v-d3afb744></span></div></div><div class="page" data-v-4a448231 data-v-efa6c2c5><div class="vp-doc" data-v-efa6c2c5><div style="position:relative;" data-v-efa6c2c5><div><h1 id="webassembly-基础-二" tabindex="-1">WebAssembly 基础（二） <a class="header-anchor" href="#webassembly-基础-二" aria-label="Permalink to &quot;WebAssembly 基础（二）&quot;">​</a></h1><p>2025年09月02日</p><blockquote><p>本系列是读书笔记第二篇，比较零散</p></blockquote><nav class="table-of-contents"><ul><li><a href="#wasm-二进制格式结构">wasm 二进制格式结构</a><ul><li><a href="#_0-自定义段-custom-section">0. 自定义段 Custom Section</a></li><li><a href="#_1-类型段-type-section">1. 类型段 Type Section</a></li><li><a href="#_2-导入段-​​import-section">2. 导入段 ​​Import Section</a></li><li><a href="#_3-函数段-function-section">3. 函数段 Function Section</a></li><li><a href="#_4-表段-table-section">4. 表段 Table Section</a></li><li><a href="#_5-内存段-memory-section">5. 内存段 Memory Section</a></li><li><a href="#_6-全局段-global-section">6. 全局段 Global Section</a></li><li><a href="#_7-导出段-​​export-section">7. 导出段 ​​Export Section</a></li><li><a href="#_8-起始段-​​start-section">8. 起始段 ​​Start Section</a></li><li><a href="#_9-元素段-element-section">9. 元素段 Element Section</a></li><li><a href="#_10-代码段-code-section">10. 代码段 Code Section</a></li><li><a href="#_11-数据段-data-section">11. 数据段 Data Section</a></li></ul></li><li><a href="#wat-语法">wat 语法</a><ul><li><a href="#_1-模块定义-module">1. 模块定义 Module</a></li><li><a href="#_2-函数-functions">2. 函数 Functions</a></li><li><a href="#_3-类型-types">3. 类型 Types</a></li><li><a href="#_4-内存-memory">4. 内存 Memory</a></li><li><a href="#_5-表-tables">5. 表 Tables</a></li><li><a href="#_6-全局变量-globals">6. 全局变量 Globals</a></li><li><a href="#_7-导入和导出-imports-exports">7. 导入和导出 Imports &amp; Exports</a></li><li><a href="#_8-控制流-control-flow">8. 控制流 Control Flow</a></li><li><a href="#_9-数据段初始化内存">9. 数据段初始化内存</a></li><li><a href="#_10-表初始化">10. 表初始化</a></li></ul></li></ul></nav><p>这篇介绍 wat 语法。</p><h2 id="wasm-二进制格式结构" tabindex="-1">wasm 二进制格式结构 <a class="header-anchor" href="#wasm-二进制格式结构" aria-label="Permalink to &quot;wasm 二进制格式结构&quot;">​</a></h2><p>和其他二进制格式一样，wasm 二进制格式也是以 <strong>魔术数</strong>+<strong>版本号</strong> 开头（ <strong>Magic Number</strong> + <strong>Version</strong> ），其他模块按照不同的类别聚合放在不同的<strong>段</strong>（ <strong>Segment</strong> ）中，<strong>严格按照顺序排列</strong>，分配 ID 。wasm 一共有 12 个段，魔术数 和 版本号 没有分配 ID ，位于开头，其他段均有 ID ，范围是 1~11 ，ID 0 特殊，不需要按照顺序出现。二进制文件格式对人类阅读不友好，这里详细展开讨论，只介绍每个段的功能。</p><p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/adcn7shhps4cxd1xbiyq.png" alt="wasm 二进制格式结构"></p><h3 id="_0-自定义段-custom-section" tabindex="-1">0. 自定义段 Custom Section <a class="header-anchor" href="#_0-自定义段-custom-section" aria-label="Permalink to &quot;0. 自定义段 Custom Section&quot;">​</a></h3><p>自定义段是可以用来存放任何数据，比如提供给编译器等工具使用，记录函数名等调试信息。这个段在模块中可有可无，wasm 不执行自定义段也不会出错。另外，虽然自定义段的 ID 是 0 ，但不必要出现在开头或者结尾，可以出现在任何一个非自定义段的前面或者后面，且可以存在多个自定义段。常见的内容有 sourceMap 链接、DWARF 调试信息。</p><h3 id="_1-类型段-type-section" tabindex="-1">1. 类型段 Type Section <a class="header-anchor" href="#_1-类型段-type-section" aria-label="Permalink to &quot;1. 类型段 Type Section&quot;">​</a></h3><p>列出模块中所有函数原型（或者说函数签名、函数类型），即函数的参数和返回值。类似 C 的头文件。</p><h3 id="_2-导入段-​​import-section" tabindex="-1">2. 导入段 ​​Import Section <a class="header-anchor" href="#_2-导入段-​​import-section" aria-label="Permalink to &quot;2. 导入段 ​​Import Section&quot;">​</a></h3><p>列出模块所有导入项，包括函数、内存、表、全局变量。</p><h3 id="_3-函数段-function-section" tabindex="-1">3. 函数段 Function Section <a class="header-anchor" href="#_3-函数段-function-section" aria-label="Permalink to &quot;3. 函数段 Function Section&quot;">​</a></h3><p>列出内部函数对应的签名索引。</p><h3 id="_4-表段-table-section" tabindex="-1">4. 表段 Table Section <a class="header-anchor" href="#_4-表段-table-section" aria-label="Permalink to &quot;4. 表段 Table Section&quot;">​</a></h3><p>定义模块使用的表，如函数引用。 wasm v1.0 规定只有一张表，v2.0 表数量可以有多个。</p><h3 id="_5-内存段-memory-section" tabindex="-1">5. 内存段 Memory Section <a class="header-anchor" href="#_5-内存段-memory-section" aria-label="Permalink to &quot;5. 内存段 Memory Section&quot;">​</a></h3><p>列出模块使用的线性内存，包括内存的初始页数、最大页数、内存数量。wasm v1.0 规定一个模块只能有一块内存，v2.0 内存数量可以有多个。</p><h3 id="_6-全局段-global-section" tabindex="-1">6. 全局段 Global Section <a class="header-anchor" href="#_6-全局段-global-section" aria-label="Permalink to &quot;6. 全局段 Global Section&quot;">​</a></h3><p>定义全局变量及其初始值。</p><h3 id="_7-导出段-​​export-section" tabindex="-1">7. 导出段 ​​Export Section <a class="header-anchor" href="#_7-导出段-​​export-section" aria-label="Permalink to &quot;7. 导出段 ​​Export Section&quot;">​</a></h3><p>声明模块对外暴露的对象。</p><h3 id="_8-起始段-​​start-section" tabindex="-1">8. 起始段 ​​Start Section <a class="header-anchor" href="#_8-起始段-​​start-section" aria-label="Permalink to &quot;8. 起始段 ​​Start Section&quot;">​</a></h3><p>指定起始函数，类似于 C 的 <code>main</code> 函数，在模块初始化时自动执行。</p><h3 id="_9-元素段-element-section" tabindex="-1">9. 元素段 Element Section <a class="header-anchor" href="#_9-元素段-element-section" aria-label="Permalink to &quot;9. 元素段 Element Section&quot;">​</a></h3><p>表的初始化数据。</p><h3 id="_10-代码段-code-section" tabindex="-1">10. 代码段 Code Section <a class="header-anchor" href="#_10-代码段-code-section" aria-label="Permalink to &quot;10. 代码段 Code Section&quot;">​</a></h3><p>所有函数的二进制指令。函数段（ID 3）和代码段（ID 10）必须一一对应。</p><h3 id="_11-数据段-data-section" tabindex="-1">11. 数据段 Data Section <a class="header-anchor" href="#_11-数据段-data-section" aria-label="Permalink to &quot;11. 数据段 Data Section&quot;">​</a></h3><p>初始化线性内存。</p><p>其中，类型段（1）、函数段（3）、代码段（10）是必需的，其他段可以省略，自定义段不参与代码执行。3 和 10 对应，4 和 9 对应，5 和 11 对应。</p><p>因为 wasm 具有<strong>严格的段顺序</strong>，<strong>支持流式加载</strong>，所以 wasm 可以一边加载，一边解析，一边验证，一边编译，初始化效率非常高。</p><p>wasm 二进制格式采用小端方式（Little-Endian）编码，wasm 的魔术数为 <code>\0asm</code> ，占 4 个字节，版本号也占 4 个字节，<code>\0asm</code> 十六进制编码为 <code>0x6D736100</code> ，版本为 1 十六进制编码为 <code>0x00000001</code> 。在 wasm 文件中编码为</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>00 61 73 6D 01 00 00 00</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>wasm 采用 <a href="https://en.wikipedia.org/wiki/LEB128" target="_blank" rel="noreferrer">LEB128</a> 编码整数值，采用 <a href="https://en.wikipedia.org/wiki/IEEE_754" target="_blank" rel="noreferrer">IEEE 754</a> 编码浮点数值。 LEB128 是一种变长码压缩，可以减少整型数的存储空间，压缩代码；IEEE 754 是常用的浮点数储存方法，这两个编码方式这里不展开。</p><p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/yv9hjhgge9jqdwdv3kn2.png" alt="wasm binary code"></p><h2 id="wat-语法" tabindex="-1">wat 语法 <a class="header-anchor" href="#wat-语法" aria-label="Permalink to &quot;wat 语法&quot;">​</a></h2><p>wat 是 wasm 文本格式（ WebAssembly Text ），基于 <strong>S-Expression</strong> 的一种嵌套括号结构，是 wasm 等效的文本形式，失去了 wasm 严格的段顺序，取而代之的是更容易阅读的表达式顺序。wat 和 wasm 之间可以使用 <a href="https://github.com/WebAssembly/wabt" target="_blank" rel="noreferrer"><code>wabt</code></a> 工具转换。这里介绍一下 wat 核心语法结构。</p><blockquote><p>S 表示 symbolic ，符号的。</p></blockquote><h3 id="_1-模块定义-module" tabindex="-1">1. 模块定义 Module <a class="header-anchor" href="#_1-模块定义-module" aria-label="Permalink to &quot;1. 模块定义 Module&quot;">​</a></h3><p>一个 wasm/wat 文件定义一个模块，以 <code>(module ...)</code> 代码包裹：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(module</span></span>
<span class="line"><span>  ;; 内部包含：函数、内存、表、全局变量等定义</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>wat 使用 <code>;;</code> 注释</p></blockquote><h3 id="_2-函数-functions" tabindex="-1">2. 函数 Functions <a class="header-anchor" href="#_2-函数-functions" aria-label="Permalink to &quot;2. 函数 Functions&quot;">​</a></h3><h4 id="_2-1-函数签名" tabindex="-1">2.1 函数签名 <a class="header-anchor" href="#_2-1-函数签名" aria-label="Permalink to &quot;2.1 函数签名&quot;">​</a></h4><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(func $name (param $a i32) (param $b f64) (result f64) ...)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><ul><li>$name：函数名（可选，调试用）</li><li>param：参数类型（如 i32, f64）</li><li>result：返回值类型</li></ul><p>wasm v1.0 规定函数只能有一个返回值，wasm v2.0 函数可以返回多个值，例如</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(func $duplicate (param $x i32) (result i32 i32)</span></span>
<span class="line"><span>  local.get $x   ;; 第一个返回值</span></span>
<span class="line"><span>  local.get $x   ;; 第二个返回值</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>在 JavaScript 中 <code>WebAssembly.Instance</code> 只支持一个返回值，当有多个返回值时，会自动封装成<strong>数组</strong>。</p><div class="language-JavaScript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">JavaScript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.exports.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">duplicate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// [5, 5]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_2-2-局部变量" tabindex="-1">2.2 局部变量 <a class="header-anchor" href="#_2-2-局部变量" aria-label="Permalink to &quot;2.2 局部变量&quot;">​</a></h4><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(func (param i32)</span></span>
<span class="line"><span>  (local.get 0)           ;; 获取第 0 个参数</span></span>
<span class="line"><span>  (local $var i32)        ;; 声明局部变量</span></span>
<span class="line"><span>  (local $a f64 $b i64)   ;; 声明多个同类型变量</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="_2-3-函数体指令" tabindex="-1">2.3 函数体指令 <a class="header-anchor" href="#_2-3-函数体指令" aria-label="Permalink to &quot;2.3 函数体指令&quot;">​</a></h4><p>指令按 ​​ 栈模型 ​​ 顺序执行</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(func $add (param $a i32) (param $b i32) (result i32)</span></span>
<span class="line"><span>  local.get $a    ;; 将 $a 压栈</span></span>
<span class="line"><span>  local.get $b    ;; 将 $b 压栈</span></span>
<span class="line"><span>  i32.add         ;; 弹出栈顶两个值，相加后压回结果</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_3-类型-types" tabindex="-1">3. 类型 Types <a class="header-anchor" href="#_3-类型-types" aria-label="Permalink to &quot;3. 类型 Types&quot;">​</a></h3><p>类型可以是 inline 的，也可以显式定义复用：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(type $AddSig (func (param i32 i32) (result i32)))</span></span>
<span class="line"><span>(func $add (type $AddSig)</span></span>
<span class="line"><span>  local.get 0</span></span>
<span class="line"><span>  local.get 1</span></span>
<span class="line"><span>  i32.add</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-内存-memory" tabindex="-1">4. 内存 Memory <a class="header-anchor" href="#_4-内存-memory" aria-label="Permalink to &quot;4. 内存 Memory&quot;">​</a></h3><h4 id="_4-1-内存定义" tabindex="-1">4.1 内存定义 <a class="header-anchor" href="#_4-1-内存定义" aria-label="Permalink to &quot;4.1 内存定义&quot;">​</a></h4><p>wasm 只有四种数据类型 <code>i32</code> <code>i64</code> <code>f32</code> <code>f64</code> ，当需要处理其他的数据类型时，需要使用内存。内存可以在 JavaScript 中定义，也可以在 wasm 内部定义：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 内部定义</span></span>
<span class="line"><span>(memory &lt;min&gt; &lt;max&gt;?)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>内存可以具名，方便导出：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(module</span></span>
<span class="line"><span>  ;; 定义内存：初始 5 页 (5 * 64KiB)，最大 10 页</span></span>
<span class="line"><span>  (memory $mem 5 10)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ;; 导出内存，方便外部访问</span></span>
<span class="line"><span>  (export &quot;memory&quot; (memory $mem))</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>内存可以从宿主导入：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 导入外部定义</span></span>
<span class="line"><span>;; 从 JavaScript 导入一个内存对象，模块名 &quot;js&quot;，内存名 &quot;mem&quot;</span></span>
<span class="line"><span>(import &quot;js&quot; &quot;mem&quot; (memory 5 10))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>JavaScript 定义：</p><div class="language-JavaScript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">JavaScript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> memory</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WebAssembly.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Memory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  initial: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 5 页</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  maximum: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 最大 10 页</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> response</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WebAssembly.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">instantiateStreaming</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  js: { mem: memory }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>宿主导入的内存初始页数和最大页数要覆盖 wat 导入定义的初始页数和最大页数，也就是说，<strong>wat 导入声明初始页数 ​​≤​​ 宿主初始页数</strong>，<strong>宿主最大页数 ≥​​ wat 导入声明最大页数</strong>。否则模块初始化时，在验证阶段会报错。</p><h4 id="_4-2-读内存" tabindex="-1">4.2 读内存 <a class="header-anchor" href="#_4-2-读内存" aria-label="Permalink to &quot;4.2 读内存&quot;">​</a></h4><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 内存读取</span></span>
<span class="line"><span>[类型].load[位数][_符号]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>符号后缀有两种， <code>_u</code> 表示无符号， <code>_s</code> 表示有符号。</p><p>常用的指令有：</p><ul><li><p><code>i32.load</code> <code>i32.load8_s</code> <code>i32.load8_u</code> <code>i32.load16_s</code> <code>i32.load16_u</code></p></li><li><p><code>i64.load</code> <code>i64.load8_s</code> <code>i64.load8_u</code> <code>i64.load16_s</code> <code>i64.load16_u</code> <code>i64.load32_s</code> <code>i64.load32_u</code></p></li><li><p><code>f32.load</code></p></li><li><p><code>f64.load</code></p></li></ul><p>加载指令看起来比较复杂，比如 <code>i32.load8_s</code> ，这条指令各部分的含义是：</p><ul><li><p>i32：结果类型是 32 位整数</p></li><li><p>load：表示从内存中加载数据</p></li><li><p>8：表示加载的数据宽度是 8 位 (1 字节)</p></li><li><p>_s：表示是有符号扩展（sign-extend）</p></li></ul><p><code>从内存中读取 8 位 (0..255) -&gt; 这 8 位数字是有符号整型 (-128..127) -&gt; 扩展成 32 位整数 (i32) -&gt; 返回</code></p><p>例如：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(func (param $ptr i32) (result i32)</span></span>
<span class="line"><span>  local.get $ptr ;; 内存地址偏移量</span></span>
<span class="line"><span>  i32.load8_s    ;; 返回 -128..127 的无符号字节</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>读内存指令除了指定地址参数外，还可以指定对齐方式和地址偏移量，默认这两个参数可以省略。如果需要指定对齐方式和偏移，指令变成：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>[类型].load[位数][_符号] align=N offset=M</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这里 N 表示 2 的次幂，<code>align=3</code> 表示按 2³ = 8 字节对齐。</p><p>如果不指定对齐参数，那么将会使用<code>自然对齐</code>，即访问内存的数据长度。如 <code>i32.load8_u</code> 自然对齐为 8 位，一个字节，<code>align=0</code> 。</p><p>在很多 CPU 架构上，内存访问对齐可以提升性能（按数据类型的自然边界访问更快），指令带上对齐信息，能帮助编译器做优化。一般地，对齐参数和读取的位数量保持一致可以获得更好的性能，如 <code>i32.load</code> 自然对齐是 4 字节，即 <code>align=2</code> ，<code>i64.load</code> 自然对齐是 8 字节，<code>align=3</code> 。如果指定了一个不合适的对齐方式参数，代码不会跑飞，编译器在编译的时候会去拼凑数据，使得字节数是对齐的，性能会变差。</p><p>内存地址偏移量是一个无符号 32 位整型数，使用这个参数相当于扩展了 wasm 的寻址范围。在不使用偏移量时内存的寻址范围是 <code>2^32-1</code> 大约为 4GB ；使用偏移量之后，寻址范围扩展到 <code>2^32-1 + 2^32-1 = 2^33 - 2</code> 大约是 8GB 。有些情况下最大内存不超过 4GB （取决于宿主），如果尝试越界访问，会触发越界异常 trap 。</p><h4 id="_4-3-写内存" tabindex="-1">4.3 写内存 <a class="header-anchor" href="#_4-3-写内存" aria-label="Permalink to &quot;4.3 写内存&quot;">​</a></h4><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 内存写入</span></span>
<span class="line"><span>[类型].store[位数]</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>常用的指令有：</p><ul><li><p><code>i32.store8</code> <code>i32.store16</code> <code>i32.store</code>（默认 32 位）</p></li><li><p><code>i64.store8</code> <code>i64.store16</code> <code>i64.store32</code> <code>i64.store</code> （默认 64 位）</p></li><li><p><code>f32.store</code></p></li><li><p><code>f64.store</code></p></li></ul><p>例如：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 把字节 72 (&#39;H&#39;) 写入位置 0</span></span>
<span class="line"><span>i32.const 0     ;; address</span></span>
<span class="line"><span>i32.const 72    ;; value</span></span>
<span class="line"><span>i32.store8      ;; 在 address 写一个字节</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>利用更宽的指令可以一次性写入更多数据，要注意 wasm 采用小端存储：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 写入字符 &#39;h&#39; &#39;e&#39; &#39;l&#39; &#39;l&#39;</span></span>
<span class="line"><span>i32.const 0           ;; 内存地址</span></span>
<span class="line"><span>i32.const 0x6c6c6568  ;; memory bytes -&gt; 68 65 6c 6c =&gt; &#39;h&#39;,&#39;e&#39;,&#39;l&#39;,&#39;l&#39;</span></span>
<span class="line"><span>i32.store</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>写内存指令也可以提供<strong>对齐参数</strong>和<strong>偏移量</strong>，含义和读内存一致，这里就不赘述了。</p><h4 id="_4-4-字符串直接写入" tabindex="-1">4.4 字符串直接写入 <a class="header-anchor" href="#_4-4-字符串直接写入" aria-label="Permalink to &quot;4.4 字符串直接写入&quot;">​</a></h4><p>wasm 只支持 4 中数值数据类型，如何将字符串直接写入内存？字符串写入需要使用 <code>data</code> 指令，以 UTF-8 字节写入内存：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 字符串写入默认内存</span></span>
<span class="line"><span>(data (i32.const &lt;offset&gt;) &quot;bytes&quot; ...)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>;; 字符串写入具名内存</span></span>
<span class="line"><span>(data (memory $mem) (i32.const &lt;offset&gt;) &quot;xxx\00&quot;)  ;; \00 表示终止符</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>举个例子，往内存中写入 “Hello World”：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(data (i32.const 0) &quot;hello world\00&quot;)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="_4-5-其他内存控制指令" tabindex="-1">4.5 其他内存控制指令 <a class="header-anchor" href="#_4-5-其他内存控制指令" aria-label="Permalink to &quot;4.5 其他内存控制指令&quot;">​</a></h4><ul><li><p><code>memory.size</code> 返回当前内存页数（i32，单位 page）</p></li><li><p><code>memory.grow</code> 内存增长，参数为需要增长的页数，执行成功返回增长前的页数（失败返回 -1）</p></li><li><p><code>memory.copy</code> 参数为 dest src len ，把<code>源地址+长度</code>的数据复制到<code>目标地址+长度</code>内存中，支持重叠</p></li><li><p><code>memory.fill</code> 参数为 dest value len ，把 len 个字节填充为 value</p></li></ul><h3 id="_5-表-tables" tabindex="-1">5. 表 Tables <a class="header-anchor" href="#_5-表-tables" aria-label="Permalink to &quot;5. 表 Tables&quot;">​</a></h3><p>表有两种类型，一种是函数引用 <code>funcref</code> ，另一种是宿主对象引用（外部引用） <code>externref</code> 。基本的语法为</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(table $tbl &lt;min&gt; &lt;max&gt;? &lt;reftype&gt;)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>min</code> 定义了表的最小尺寸，<code>max</code> 定义表最大扩展尺寸。表的尺寸限定函数/引用的数量。表是 wasm 和宿主之间隐藏代码位置，间接调用/访问的方法。假如 wasm 要向 JavaScript 提供自增和自减两个函数，但不希望宿主直接获取函数的索引：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; xxx.wat</span></span>
<span class="line"><span>(module</span></span>
<span class="line"><span>  ;; 定义一个函数类型：参数类型 i32，返回类型 i32</span></span>
<span class="line"><span>  (type $t (func (param i32) (result i32)))</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ;; 定义两个函数</span></span>
<span class="line"><span>  (func $inc (type $t) (param $x i32) (result i32)</span></span>
<span class="line"><span>    local.get $x</span></span>
<span class="line"><span>    i32.const 1</span></span>
<span class="line"><span>    i32.add</span></span>
<span class="line"><span>  )</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  (func $dec (type $t) (param $x i32) (result i32)</span></span>
<span class="line"><span>    local.get $x</span></span>
<span class="line"><span>    i32.const 1</span></span>
<span class="line"><span>    i32.sub</span></span>
<span class="line"><span>  )</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ;; 定义一个表，初始大小 2，最大 5，用来存放函数引用</span></span>
<span class="line"><span>  (table $tbl 2 5 funcref)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ;; 初始化表内容：索引 0 存 $inc，索引 1 存 $dec</span></span>
<span class="line"><span>  (elem (i32.const 0) $inc $dec)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  ;; 使用 call_indirect 调用表中的函数</span></span>
<span class="line"><span>  ;; 参数：表索引、函数参数</span></span>
<span class="line"><span>  (func (export &quot;call_from_table&quot;) (param $idx i32) (param $x i32) (result i32)</span></span>
<span class="line"><span>    local.get $x      ;; push 参数</span></span>
<span class="line"><span>    local.get $idx    ;; push 函数索引</span></span>
<span class="line"><span>    call_indirect (type $t) (table $tbl)</span></span>
<span class="line"><span>  )</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><div class="language-JavaScript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">JavaScript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">instance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> WebAssembly.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">instantiateStreaming</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">fetch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;xxx.wasm&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.exports.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call_from_table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 11 (自增)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(instance.exports.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">call_from_table</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 9  (自减)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>其他指令：</p><ul><li><p><code>table.get &lt;tableidx&gt;</code> 从表里取出一个引用</p></li><li><p><code>table.set &lt;tableidx&gt;</code> 向表中写入一个引用</p></li><li><p><code>table.size &lt;tableidx&gt;</code> 取表当前大小</p></li><li><p><code>table.grow &lt;tableidx&gt;</code> 扩展表容量</p></li><li><p><code>table.fill &lt;tableidx&gt;</code> 批量填充某个引用</p></li><li><p><code>table.copy &lt;dst&gt; &lt;src&gt;</code> 从一张表拷贝到另一张表</p></li></ul><h3 id="_6-全局变量-globals" tabindex="-1">6. 全局变量 Globals <a class="header-anchor" href="#_6-全局变量-globals" aria-label="Permalink to &quot;6. 全局变量 Globals&quot;">​</a></h3><p>全局变量可以定位为常量或变量：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(global $counter (mut i32) (i32.const 0)) ;; 可变全局变量</span></span>
<span class="line"><span>(global $PI f64 (f64.const 3.14159))      ;; 常量</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_7-导入和导出-imports-exports" tabindex="-1">7. 导入和导出 Imports &amp; Exports <a class="header-anchor" href="#_7-导入和导出-imports-exports" aria-label="Permalink to &quot;7. 导入和导出 Imports &amp; Exports&quot;">​</a></h3><h4 id="_7-1-导入" tabindex="-1">7.1 导入 <a class="header-anchor" href="#_7-1-导入" aria-label="Permalink to &quot;7.1 导入&quot;">​</a></h4><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 导入函数</span></span>
<span class="line"><span>(import &quot;env&quot; &quot;log&quot; (func $log (param i32)))</span></span>
<span class="line"><span>;; 导入内存</span></span>
<span class="line"><span>(import &quot;js&quot; &quot;mem&quot; (memory 1))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="_7-2-导出" tabindex="-1">7.2 导出 <a class="header-anchor" href="#_7-2-导出" aria-label="Permalink to &quot;7.2 导出&quot;">​</a></h4><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 导出函数</span></span>
<span class="line"><span>(export &quot;add&quot; (func $add))</span></span>
<span class="line"><span>;; 导出内存</span></span>
<span class="line"><span>(export &quot;shared_mem&quot; (memory $mem))</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="_8-控制流-control-flow" tabindex="-1">8. 控制流 Control Flow <a class="header-anchor" href="#_8-控制流-control-flow" aria-label="Permalink to &quot;8. 控制流 Control Flow&quot;">​</a></h3><p>wasm 的控制流指令有四类：块/循环、条件、跳转、控制。</p><h4 id="_8-1-块-循环" tabindex="-1">8.1 块/循环 <a class="header-anchor" href="#_8-1-块-循环" aria-label="Permalink to &quot;8.1 块/循环&quot;">​</a></h4><p><code>block</code> 和 <code>loop</code> 。<code>block</code> 创建具名的代码块，可以声明返回值，块结束时会把栈顶值作为块的返回值，配合 <code>br*</code> 可以实现跳转。</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(block $label (result &lt;type&gt;?) ... )</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><code>loop</code> 是创建循环结构的入口，同样可以声明返回值，循环结束时会把栈顶值作为块的返回值，需要配合 <code>br*</code> 跳转到循环开头。如果循环块中没有 <code>br*</code> ，<code>loop</code> 并不会自动循环。</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(loop $label (result &lt;type&gt;?) ... )</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>例如：</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 等效于 for (let i = 0; i &lt; 5; i++) {}</span></span>
<span class="line"><span>(local $i i32)</span></span>
<span class="line"><span>(loop $start</span></span>
<span class="line"><span>  (local.set $i (i32.add (local.get $i) 1))</span></span>
<span class="line"><span>  (br_if $start (i32.lt_s (local.get $i) (i32.const 5)))  ;; 循环5次</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="_8-2-条件" tabindex="-1">8.2 条件 <a class="header-anchor" href="#_8-2-条件" aria-label="Permalink to &quot;8.2 条件&quot;">​</a></h4><p><code>if</code> 用栈顶 i32 数值作为条件选择执行 <code>then</code> 或者 <code>else</code>，可以声明返回值，<code>then</code> 和 <code>else</code> 必须产生这个类型的返回。</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(if (result &lt;type&gt;?)</span></span>
<span class="line"><span>  (then ...)</span></span>
<span class="line"><span>  (else ...)</span></span>
<span class="line"><span>  (end)</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>例如编写一个输出参数绝对值加一的函数：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(func (param $x i32) (result i32)</span></span>
<span class="line"><span>  local.get $x</span></span>
<span class="line"><span>  i32.const 0</span></span>
<span class="line"><span>  i32.lt_s        ;; x &lt; 0 ?</span></span>
<span class="line"><span>  if (result i32)</span></span>
<span class="line"><span>    ;; then: x 是负数 -&gt; return -x + 1</span></span>
<span class="line"><span>    local.get $x</span></span>
<span class="line"><span>    i32.const -1</span></span>
<span class="line"><span>    i32.mul       ;; 取反 x = x * -1</span></span>
<span class="line"><span>    i32.const 1</span></span>
<span class="line"><span>    i32.add</span></span>
<span class="line"><span>  else</span></span>
<span class="line"><span>    ;; else: x &gt;= 0 -&gt; x + 1</span></span>
<span class="line"><span>    local.get $x</span></span>
<span class="line"><span>    i32.const 1</span></span>
<span class="line"><span>    i32.add</span></span>
<span class="line"><span>  end</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h4 id="_8-3-跳转" tabindex="-1">8.3 跳转 <a class="header-anchor" href="#_8-3-跳转" aria-label="Permalink to &quot;8.3 跳转&quot;">​</a></h4><p>跳转指令有 3 个：无条件跳转 <code>br</code> ，条件跳转 <code>br_if</code> ，多路分支跳转 <code>br_table</code> 。</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; 无条件跳转</span></span>
<span class="line"><span>br &lt;label&gt;</span></span>
<span class="line"><span>;; 消耗栈顶(i32)，若非零则跳转</span></span>
<span class="line"><span>br_if &lt;label&gt;</span></span>
<span class="line"><span>;; 栈顶(i32)作为索引，如果栈顶是 `[0, n]` 则跳转到对应的 `label` ，否则跳转到 `default`</span></span>
<span class="line"><span>br_table &lt;label_0&gt; &lt;label_1&gt; ... &lt;label_n&gt; &lt;default_label&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><code>&lt;label&gt;</code> 可以是块的名称，也可以使 <code>i32</code> 数字，使用数字时，表示跳出的层级，<code>0</code> 表示跳出当前层级，<code>1</code> 表示跳出父层级，以此类推。建议使用块名称。所谓跳转，并非跳转到定义块的首行，而是跳转到定义块的结尾。</p><p>举几个例子：</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; br</span></span>
<span class="line"><span>(block $outer</span></span>
<span class="line"><span>  (block $inner</span></span>
<span class="line"><span>    (br $outer)  ;; 直接跳出到 $outer</span></span>
<span class="line"><span>  )</span></span>
<span class="line"><span>  (unreachable)   ;; 此处往后，块内指令不会执行</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; br_if</span></span>
<span class="line"><span>(func (param $p i32) (result i32)</span></span>
<span class="line"><span>  (block $outer (result i32)</span></span>
<span class="line"><span>    (block $inner</span></span>
<span class="line"><span>      local.get $p</span></span>
<span class="line"><span>      i32.const 0</span></span>
<span class="line"><span>      i32.eq</span></span>
<span class="line"><span>      ;; 如果输入 p === 0 则跳到 $outer，带上 999 作为 $outer 的返回值</span></span>
<span class="line"><span>      i32.const 999</span></span>
<span class="line"><span>      br_if $outer</span></span>
<span class="line"><span>    )</span></span>
<span class="line"><span>    ;; 没有跳转则到这里，$outer 返回 123</span></span>
<span class="line"><span>    i32.const 123</span></span>
<span class="line"><span>  )</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>;; br_table</span></span>
<span class="line"><span>(func (param $i i32) (result i32)</span></span>
<span class="line"><span>  (block $end (result i32)</span></span>
<span class="line"><span>    (block $default</span></span>
<span class="line"><span>      (block $case2</span></span>
<span class="line"><span>        (block $case1</span></span>
<span class="line"><span>          (block $case0</span></span>
<span class="line"><span>            local.get $i</span></span>
<span class="line"><span>            ;; 参数顺序： &lt;labels...&gt; &lt;default&gt;</span></span>
<span class="line"><span>            ;; idx === 0 -&gt; branch to $case0</span></span>
<span class="line"><span>            br_table $case0 $case1 $case2 $default</span></span>
<span class="line"><span>          ) ;; end $case0</span></span>
<span class="line"><span>          ;; 当分支到 $case0 时会执行下面这句</span></span>
<span class="line"><span>          i32.const 10</span></span>
<span class="line"><span>          br $end</span></span>
<span class="line"><span>        ) ;; end $case1</span></span>
<span class="line"><span>        ;; 当分支到 $case1 时会执行下面这句</span></span>
<span class="line"><span>        i32.const 20</span></span>
<span class="line"><span>        br $end</span></span>
<span class="line"><span>      ) ;; end $case2</span></span>
<span class="line"><span>      ;; 当分支到 $case2 时会执行下面这句</span></span>
<span class="line"><span>      i32.const 30</span></span>
<span class="line"><span>      br $end</span></span>
<span class="line"><span>    ) ;; end $default</span></span>
<span class="line"><span>    ;; 当 br_table 命中 default（index 超范围）时，会跳到 $default 的结束处，</span></span>
<span class="line"><span>    ;; 然后继续执行这里的代码 —— 返回默认值 99</span></span>
<span class="line"><span>    i32.const 99</span></span>
<span class="line"><span>  ) ;; end $end</span></span>
<span class="line"><span>)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p>如果块定义了返回值，记得在跳转之前先把返回值压栈。要注意返回值和判断值的压栈顺序是，<strong>先压返回值，再压判断条件</strong>，不压返回值或压栈顺序不对，类型检查会失败。</p><h4 id="_8-4-函数控制" tabindex="-1">8.4 函数控制 <a class="header-anchor" href="#_8-4-函数控制" aria-label="Permalink to &quot;8.4 函数控制&quot;">​</a></h4><p>函数控制指令有两类，一类是调用函数 <code>call</code> 和 <code>call_indirect</code> ，另一类是终止函数 <code>return</code> 。</p><p><code>call</code> 是直接调用， <code>call_indirect</code> 是使用表索引间接调用。</p><div class="language-wat vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wat</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>call $funcname</span></span>
<span class="line"><span>call_indirect (type $t) (table $tbl?)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>直接调用很简单，这里不举例了， <code>call_indirect</code> 比较复杂，在 <a href="#_5-表-tables">5. 表 Tables</a> 这一章节中有示例，可以倒回去阅读代码，这里解释参数：</p><ul><li><p><code>type $t</code> 表示当前调用的函数签名</p></li><li><p><code>table $tbl?</code> 当前调用的表索引，可以不指定，默认使用 表 0</p></li></ul><p>调用函数在表中的索引和函数参数从栈获取，栈顶是索引，然后是参数。所以<strong>压栈的顺序是先压参数后压索引</strong>。</p><p><code>return</code> 是直接跳出函数，并返回值。返回值从栈顶取，所以在执行之前先压栈。</p><h4 id="_8-5-其他" tabindex="-1">8.5 其他 <a class="header-anchor" href="#_8-5-其他" aria-label="Permalink to &quot;8.5 其他&quot;">​</a></h4><p>还有一些不太好分类的流控制指令：</p><ul><li><p><code>unreachable</code> 立即触发 trap ，即运行时异常。用于标记不应触及的路径或产生错误</p></li><li><p><code>nop</code> 空操作，不做任何事，对行为无影响，占用一个机器指令执行周期</p></li></ul><h3 id="_9-数据段初始化内存" tabindex="-1">9. 数据段初始化内存 <a class="header-anchor" href="#_9-数据段初始化内存" aria-label="Permalink to &quot;9. 数据段初始化内存&quot;">​</a></h3><p>详见 <a href="#_4-4-字符串直接写入">4.4 字符串直接写入</a>。</p><h3 id="_10-表初始化" tabindex="-1">10. 表初始化 <a class="header-anchor" href="#_10-表初始化" aria-label="Permalink to &quot;10. 表初始化&quot;">​</a></h3><p>详见 <a href="#_5-表-tables">5. 表 Tables</a>。</p></div></div><p class="last-updated" data-v-efa6c2c5> 最后更新时间: 2025年09月03日</p></div><div data-v-efa6c2c5></div><div class="footer" data-v-efa6c2c5 data-v-7d1942f1><p data-v-7d1942f1> © 2017 ~ 2025 • Yangholmes </p><p class="driver" data-v-7d1942f1> 使用 ❤️ <a href="https://vitepress.dev/" target="_blank" data-v-7d1942f1>Vitepress</a> 搭建 - Yangholmes 提供主题 </p></div></div></main></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"Bfz57W53\",\"renovation-progress.md\":\"Bmg5h1y4\",\"技术的小记_atom 改装指南_index.md\":\"DzK91jWs\",\"技术的小记_emscripten file system 入门_index.md\":\"BhnOe-a2\",\"技术的小记_extjs 自定义 datetimefield 控件_index.md\":\"CtcHWQoj\",\"技术的小记_google 地图 tms 服务参数解析_index.md\":\"Bzz7_VMo\",\"技术的小记_index.md\":\"fPAX2A_X\",\"技术的小记_javascript 变量类型判断_index.md\":\"Cgh7YAO4\",\"技术的小记_javascript 隐式转换_index.md\":\"BkQW0Fyf\",\"技术的小记_javascript 隐式转换_mermaid.md\":\"D9vr-pM3\",\"技术的小记_javascript 隐式转换_mindmap-en.md\":\"ChuzeN0e\",\"技术的小记_javascript 隐式转换_mindmap.md\":\"JCp315Vk\",\"技术的小记_photoshop 基础--如何抠图_index.md\":\"BhbjFlTg\",\"技术的小记_web 应用榨干 cpu 性能的正确姿势_index.md\":\"DLkrIN3w\",\"技术的小记_webassembly 基础（一）_index.md\":\"BM8YixpJ\",\"技术的小记_webassembly 基础（二）_index.md\":\"54W5oS0Y\",\"技术的小记_什么是原型链_index.md\":\"B2urUb26\",\"技术的小记_变量声明和作用域_index.md\":\"DfLc0Sr-\",\"技术的小记_如何为 vue 组件提供 slots 静态类型检查_index.md\":\"BkfmQ-5N\",\"技术的小记_如何在 web 应用中使用 gdal （一）_index.md\":\"B6Mzc5js\",\"技术的小记_如何在 web 应用中使用 gdal （三）_index.md\":\"8yOv3QbN\",\"技术的小记_如何在 web 应用中使用 gdal （二）_index.md\":\"DCdIY6OY\",\"技术的小记_如何设计一个 brainfuck 解释器_index.md\":\"B4L79Qca\",\"技术的小记_如何设计一个易用的tag组件_index.md\":\"Bap9Prbk\",\"技术的小记_浏览器事件循环_index.md\":\"BHneFH9r\",\"技术的小记_脚本化css_index.md\":\"s-IOhQnh\",\"派的玩耍小记_c 的 main 函数_index.md\":\"DqjmhADp\",\"派的玩耍小记_gcc 的编译过程_index.md\":\"CYwdwGqT\",\"派的玩耍小记_index.md\":\"tg8UpLoU\",\"派的玩耍小记_orangepi lite 2 刷 ubuntu 18.04.4 方法_index.md\":\"wGfvgCcZ\",\"派的玩耍小记_新到的玩具_index.md\":\"jFXBeqRQ\",\"派的玩耍小记_驱动步进电机_index.md\":\"BGzSTwrH\",\"生活咏叹调_index.md\":\"Bd7cw6Ae\",\"生活咏叹调_两个和尚的故事_index.md\":\"C4rszWZA\",\"生活咏叹调_我居然想变老_index.md\":\"CqmUDp1y\",\"生活咏叹调_生命_index.md\":\"BeXWteUc\",\"生活咏叹调_生活宝鉴_index.md\":\"jcu1ec4U\",\"生活咏叹调_顽强的绿萝_index.md\":\"fNBt1Dwt\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-cn\",\"dir\":\"ltr\",\"title\":\"Yangholmes' blog\",\"description\":\"Yangholmes' blog\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"categories\":[\"技术的小记\",\"派的玩耍小记\",\"生活咏叹调\"],\"posts\":{\"技术的小记\":[{\"title\":\"WebAssembly 基础（二）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/WebAssembly 基础（二）\",\"createDate\":\"2025/09/02\",\"excerpt\":\"\"},{\"title\":\"EMSCRIPTEN File System 入门\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/EMSCRIPTEN File System 入门\",\"createDate\":\"2025/08/26\",\"excerpt\":\"\"},{\"title\":\"如何在 web 应用中使用 GDAL （三）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何在 web 应用中使用 GDAL （三）\",\"createDate\":\"2025/08/18\",\"excerpt\":\"\"},{\"title\":\"JavaScript 隐式转换\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/JavaScript 隐式转换\",\"createDate\":\"2025/08/13\",\"excerpt\":\"\"},{\"title\":\"如何在 web 应用中使用 GDAL （二）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何在 web 应用中使用 GDAL （二）\",\"createDate\":\"2025/08/10\",\"excerpt\":\"\"},{\"title\":\"如何在 web 应用中使用 GDAL （一）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何在 web 应用中使用 GDAL （一）\",\"createDate\":\"2025/08/04\",\"excerpt\":\"\"},{\"title\":\"JavaScript 变量类型判断\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/JavaScript 变量类型判断\",\"createDate\":\"2025/07/12\",\"excerpt\":\"\"},{\"title\":\"如何为 Vue 组件提供 slots 静态类型检查\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何为 Vue 组件提供 slots 静态类型检查\",\"createDate\":\"2025/05/28\",\"excerpt\":\"\"},{\"title\":\"WebAssembly 基础（一）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/WebAssembly 基础（一）\",\"createDate\":\"2024/06/21\",\"excerpt\":\"\"},{\"title\":\"google 地图 TMS 服务参数解析\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/google 地图 TMS 服务参数解析\",\"createDate\":\"2023/08/17\",\"excerpt\":\"\"},{\"title\":\"浏览器事件循环\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/浏览器事件循环\",\"createDate\":\"2023/05/22\",\"excerpt\":\"\"},{\"title\":\"变量声明和作用域\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/变量声明和作用域\",\"createDate\":\"2022/08/21\",\"excerpt\":\"\"},{\"title\":\"web 应用榨干 CPU 性能的正确姿势\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/web 应用榨干 CPU 性能的正确姿势\",\"createDate\":\"2021/09/03\",\"excerpt\":\"\"},{\"title\":\"什么是原型链\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/什么是原型链\",\"createDate\":\"2021/01/13\",\"excerpt\":\"\"},{\"title\":\"Atom 改装指南\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/Atom 改装指南\",\"createDate\":\"2018/06/22\",\"excerpt\":\"\"},{\"title\":\"如何设计一个 BrainFuck 解释器\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何设计一个 BrainFuck 解释器\",\"createDate\":1526860800000,\"excerpt\":\"\"},{\"title\":\"如何设计一个易用的tag组件\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何设计一个易用的tag组件\",\"createDate\":1526342400000,\"excerpt\":\"\"},{\"title\":\"PhotoShop 基础--如何抠图\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/PhotoShop 基础--如何抠图\",\"createDate\":\"2016/06/04\",\"excerpt\":\"\"},{\"title\":\"脚本化CSS\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/脚本化CSS\",\"createDate\":\"2016/05/09\",\"excerpt\":\"\"},{\"title\":\"ExtJS 自定义 datetimefield 控件\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/ExtJS 自定义 datetimefield 控件\",\"createDate\":\"2016/05/07\",\"excerpt\":\"\"}],\"派的玩耍小记\":[{\"title\":\"OrangePi Lite 2 刷 Ubuntu 18.04.4 方法\",\"category\":\"派的玩耍小记\",\"url\":\"/派的玩耍小记/OrangePi Lite 2 刷 Ubuntu 18.04.4 方法\",\"createDate\":\"2020/05/03\",\"excerpt\":\"\"},{\"title\":\"驱动步进电机\",\"category\":\"派的玩耍小记\",\"url\":\"/派的玩耍小记/驱动步进电机\",\"createDate\":\"2019/11/23\",\"excerpt\":\"\"},{\"title\":\"C 的 main 函数\",\"category\":\"派的玩耍小记\",\"url\":\"/派的玩耍小记/C 的 main 函数\",\"createDate\":\"2019/10/27\",\"excerpt\":\"\"},{\"title\":\"gcc 的编译过程\",\"category\":\"派的玩耍小记\",\"url\":\"/派的玩耍小记/gcc 的编译过程\",\"createDate\":\"2019/10/27\",\"excerpt\":\"\"},{\"title\":\"新到的玩具\",\"category\":\"派的玩耍小记\",\"url\":\"/派的玩耍小记/新到的玩具\",\"createDate\":1572019200000,\"excerpt\":\"\"}],\"生活咏叹调\":[{\"title\":\"生活宝鉴\",\"category\":\"生活咏叹调\",\"url\":\"/生活咏叹调/生活宝鉴\",\"createDate\":\"2021/05/09\",\"excerpt\":\"\"},{\"title\":\"两个和尚的故事\",\"category\":\"生活咏叹调\",\"url\":\"/生活咏叹调/两个和尚的故事\",\"createDate\":\"2021/02/26\",\"excerpt\":\"\"},{\"title\":\"顽强的绿萝\",\"category\":\"生活咏叹调\",\"url\":\"/生活咏叹调/顽强的绿萝\",\"createDate\":\"2020/11/19\",\"excerpt\":\"\"},{\"title\":\"生命\",\"category\":\"生活咏叹调\",\"url\":\"/生活咏叹调/生命\",\"createDate\":\"2020/11/18\",\"excerpt\":\"\"},{\"title\":\"我居然想变老\",\"category\":\"生活咏叹调\",\"url\":\"/生活咏叹调/我居然想变老\",\"createDate\":\"2020/11/17\",\"excerpt\":\"\"}]},\"lastUpdated\":true,\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Yangholmes\"},{\"icon\":\"dev\",\"link\":\"https://dev.to/yangholmes\"},{\"icon\":\"instagram\",\"link\":\"https://www.instagram.com/yangholmes/\"},{\"icon\":\"wechat\",\"link\":\"/wechat-qrcode.png\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  <script type="text/javascript">
          (function(c,l,a,r,i,t,y){
              c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
              t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
              y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
          })(window, document, "clarity", "script", "sqwvxx7phf");
        </script></body>
</html>