<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>在 WebAssembly 中使用 SIMD （一） | Yangholmes' blog</title>
    <meta name="description" content="Yangholmes' blog">
    <meta name="generator" content="VitePress v1.6.4">
    <link rel="preload stylesheet" href="/assets/style.D5MO-rW_.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.Ce5WR8OF.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.GQWhFI7o.js">
    <link rel="modulepreload" href="/assets/chunks/theme.DR_XWUYV.js">
    <link rel="modulepreload" href="/assets/chunks/katex.ChWnQ-fc.js">
    <link rel="modulepreload" href="/assets/chunks/dagre-JOIXM2OF.CB7b_3_A.js">
    <link rel="modulepreload" href="/assets/chunks/c4Diagram-6F6E4RAY.DyKH7PSa.js">
    <link rel="modulepreload" href="/assets/chunks/flowDiagram-KYDEHFYC.BsKm6_-n.js">
    <link rel="modulepreload" href="/assets/chunks/erDiagram-3M52JZNH.Bvr-O66T.js">
    <link rel="modulepreload" href="/assets/chunks/gitGraphDiagram-GW3U2K7C.26osZ181.js">
    <link rel="modulepreload" href="/assets/chunks/ganttDiagram-EK5VF46D.yiP6lyXz.js">
    <link rel="modulepreload" href="/assets/chunks/infoDiagram-LHK5PUON.BZjEb0RZ.js">
    <link rel="modulepreload" href="/assets/chunks/pieDiagram-NIOCPIFQ.Bf2NtGS-.js">
    <link rel="modulepreload" href="/assets/chunks/quadrantDiagram-2OG54O6I.B1aOmqg7.js">
    <link rel="modulepreload" href="/assets/chunks/xychartDiagram-H2YORKM3.CagCFAjF.js">
    <link rel="modulepreload" href="/assets/chunks/requirementDiagram-QOLK2EJ7.DEwaSxQZ.js">
    <link rel="modulepreload" href="/assets/chunks/sequenceDiagram-SKLFT4DO.DvILkbp-.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-M3E45YP4.BwF1zRCv.js">
    <link rel="modulepreload" href="/assets/chunks/classDiagram-v2-YAWTLIQI.BwF1zRCv.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-MI5ZYTHO.PW0Q47JY.js">
    <link rel="modulepreload" href="/assets/chunks/stateDiagram-v2-5AN5P6BG.HbYhi8NA.js">
    <link rel="modulepreload" href="/assets/chunks/journeyDiagram-EWQZEKCU.DH-yfYKe.js">
    <link rel="modulepreload" href="/assets/chunks/timeline-definition-MYPXXCX6.BGCY5TdX.js">
    <link rel="modulepreload" href="/assets/chunks/mindmap-definition-6CBA2TL7.DHGdYRIe.js">
    <link rel="modulepreload" href="/assets/chunks/kanban-definition-ZSS6B67P.B3ymQvQP.js">
    <link rel="modulepreload" href="/assets/chunks/sankeyDiagram-4UZDY2LN.BvBOuWGu.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-5UYTHUR4.Ct7nwq5D.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-ZTM2IBQH.Cs3-Yu0W.js">
    <link rel="modulepreload" href="/assets/chunks/blockDiagram-6J76NXCF.D_KwLc01.js">
    <link rel="modulepreload" href="/assets/chunks/architectureDiagram-SUXI7LT5.CkpzlzlN.js">
    <link rel="modulepreload" href="/assets/chunks/diagram-VMROVX33.C6tyOb6g.js">
    <link rel="modulepreload" href="/assets/chunks/virtual_mermaid-config.DDnGl6nM.js">
    <link rel="modulepreload" href="/assets/技术的小记_在 WebAssembly 中使用 SIMD （一）_index.md.B_oKO_D7.lean.js">
    <link rel="icon" type="image/x-icon" href="/icon.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <meta property="og:title" content="在 WebAssembly 中使用 SIMD （一）">
    <meta property="og:description" content="在 WebAssembly 中使用 SIMD （一）, WebAssembly, SIMD, wabt">
    <meta property="og:type" content="website">
    <meta property="og:image" content="">
  </head>
  <body><!--teleport start anchor--><div class="overlay" data-v-de2d7834></div><!--teleport anchor-->
    <div id="app"><div class="main-layout" data-v-b69b8d14><div class="left-side" data-v-b69b8d14><div class="sidebar" data-v-b69b8d14 data-v-de2d7834><div class="mobile-only handler" data-v-de2d7834 data-v-1ae25dd3 data-v-921a77f8><!--[--><div class="toggle-handler" data-v-1ae25dd3><span class="vpi-chevron-right icon" data-v-1ae25dd3></span></div><!--]--></div><div class="top-bar" data-v-de2d7834><div class="theme-switch is-dark" data-v-de2d7834 data-v-f53d3568><div class="round-button switch sun" data-v-f53d3568 data-v-069854a3><span class="vpi-sun icon" data-v-069854a3></span></div><div class="round-button switch moon" data-v-f53d3568 data-v-069854a3><span class="vpi-moon icon" data-v-069854a3></span></div></div><div class="VPNavBarSearch plugin search" data-v-de2d7834 data-v-581573fe><!----><div id="docsearch"><!--[--><div class="round-button" data-v-581573fe data-v-069854a3><span class="vpi-search icon" data-v-069854a3></span></div><!--]--></div></div></div><nav data-v-de2d7834><div class="avatar" data-v-de2d7834 data-v-17fb32d3><a href="/" data-v-17fb32d3><div class="image" style="--image: url(/assets/cats.BfteQRM1.png)" data-v-17fb32d3></div></a><p data-v-17fb32d3>Yangholmes</p><p data-v-17fb32d3> 邋遢和小松的 <ruby data-v-17fb32d3>铲<rt data-v-17fb32d3>chǎn</rt></ruby><ruby data-v-17fb32d3>屎<rt data-v-17fb32d3>shǐ</rt></ruby><ruby data-v-17fb32d3>官<rt data-v-17fb32d3>guān</rt></ruby></p></div><ul class="category-list" data-v-de2d7834><!--[--><li class="active" data-v-de2d7834><a href="/技术的小记/" data-v-de2d7834>技术的小记</a></li><li class="" data-v-de2d7834><a href="/派的玩耍小记/" data-v-de2d7834>派的玩耍小记</a></li><li class="" data-v-de2d7834><a href="/生活咏叹调/" data-v-de2d7834>生活咏叹调</a></li><!--]--></ul><ul class="socials" data-v-de2d7834 data-v-09a88840><!--[--><li data-v-09a88840><a href="https://github.com/Yangholmes" target="_blank" rel="noopener noreferrer" data-v-09a88840><div class="social-icon" style="--mask-image: "></div></a></li><li data-v-09a88840><a href="https://dev.to/yangholmes" target="_blank" rel="noopener noreferrer" data-v-09a88840><div class="social-icon" style="--mask-image: "></div></a></li><li data-v-09a88840><a href="https://www.instagram.com/yangholmes/" target="_blank" rel="noopener noreferrer" data-v-09a88840><div class="social-icon" style="--mask-image: "></div></a></li><li data-v-09a88840><a href="/wechat-qrcode.png" target="_blank" rel="noopener noreferrer" data-v-09a88840><div class="social-icon" style="--mask-image: "></div></a></li><!--]--></ul></nav><div class="bottom-bar" data-v-de2d7834></div><!--teleport start--><!--teleport end--></div></div><main class="content" data-v-b69b8d14><div class="nav-bar" data-v-b69b8d14 data-v-aefd28cd><div class="round-button" data-v-aefd28cd data-v-069854a3><span class="vpi-arrow-left icon" data-v-069854a3></span></div></div><div class="page" data-v-b69b8d14 data-v-9b6f8dc5><div class="vp-doc" data-v-9b6f8dc5><div style="position:relative;" data-v-9b6f8dc5><div><h1 id="在-webassembly-中使用-simd-一" tabindex="-1">在 WebAssembly 中使用 SIMD （一） <a class="header-anchor" href="#在-webassembly-中使用-simd-一" aria-label="Permalink to &quot;在 WebAssembly 中使用 SIMD （一）&quot;">​</a></h1><p>2025年09月08日</p><nav class="table-of-contents"><ul><li><a href="#webassembly-的-simd-概况">WebAssembly 的 SIMD 概况</a></li><li><a href="#simd-指令集">SIMD 指令集</a></li><li><a href="#使用-simd-指令">使用 SIMD 指令</a></li><li><a href="#预告">预告</a></li></ul></nav><h2 id="webassembly-的-simd-概况" tabindex="-1">WebAssembly 的 SIMD 概况 <a class="header-anchor" href="#webassembly-的-simd-概况" aria-label="Permalink to &quot;WebAssembly 的 SIMD 概况&quot;">​</a></h2><p>WebAssembly 的 SIMD 和 CPU 的 SIMD 是一个意思，都是指 <strong>Single Instruction Multiple Data</strong> (<strong>单指令多数据</strong>) 。SIMD 指令通过同时对多个数据执行相同的操作来实现并行数据处理，进而获得矢量运算能力，计算密集型应用，例如音视频处理、编解码器、图像处理，都采用 SIMD 提升性能。SIMD 的实现依赖于 CPU ，不同的硬件条件支持的 SIMD 能力不同，所以 SIMD 指令集很大，并且在不同架构之间有所不同，当然 WebAssembly SIMD 指令集也包含其中。另一方面， WebAssembly 作为一个通用型平台，其支持的 SIMD 指令集相对比较保守，目前仅限于固定长度 16 字节（128 位）的指令集。</p><p>目前主流的大部分虚拟机都支持 SIMD ：</p><ul><li>Chrome ≥ 91 (2021 年 5 月)</li><li>Firefox ≥ 89 (2021 年 6 月)</li><li>Safari ≥ 16.4 (2023 年 3 月)</li><li>Node.js ≥ 16.4 (2021 年 6 月)</li></ul><p>使用之前先看看大部分用户使用的客户端是否支持，然后考虑在项目中增加测试代码<strong>渐进增强</strong>。渐进增强的含义是，相同功能的 wasm 模块分别用非 SIMD 和 SIMD 指令编写，嗅探宿主对 SIMD 的支持情况，如果不支持则使用非 SIMD 模块，如果支持则使用 SIMD 模块。嗅探可以使用 <a href="https://github.com/GoogleChromeLabs/wasm-feature-detect" target="_blank" rel="noreferrer">wasm-feature-detect</a> 库。这个库专门用于测试宿主对 wasm 特性支持程度，除了 SIMD 以外，这个库还可以检查诸如 64 位内存、多线程等新特性和实验特性，并且支持摇树（Tree-shakable），对 web 应用友好。</p><div class="language-JavaScript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">JavaScript</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// loadWasmModule.js</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { simd } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;wasm-feature-detect&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">url</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">simdUrl</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> simd</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">then</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">isSupported</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> isSupported </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(simdUrl) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(url);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="simd-指令集" tabindex="-1">SIMD 指令集 <a class="header-anchor" href="#simd-指令集" aria-label="Permalink to &quot;SIMD 指令集&quot;">​</a></h2><p>SIMD 指令和单字节指令类似，也是算术运算、读取写入、逻辑运算这几类。使用时需要严格按照栈式指令操作，SIMD 指令汇总：</p><table tabindex="0"><thead><tr><th style="text-align:center;">指令格式</th><th style="text-align:center;">功能描述</th><th style="text-align:center;">示例</th></tr></thead><tbody><tr><td style="text-align:center;">读取和存储</td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;"><code>v128.load offset=&lt;n&gt; align=&lt;m&gt;</code></td><td style="text-align:center;">从内存加载 128 位向量</td><td style="text-align:center;"><code>(v128.load offset=0 align=16 (i32.const 0))</code></td></tr><tr><td style="text-align:center;"><code>v128.load8_splat</code></td><td style="text-align:center;">加载 8 位整数并复制 16 次填充向量</td><td style="text-align:center;"><code>(v128.load8_splat (i32.const 42))</code></td></tr><tr><td style="text-align:center;"><code>v128.load16_splat</code></td><td style="text-align:center;">加载 16 位整数并复制 8 次填充向量</td><td style="text-align:center;"><code>(v128.load16_splat (i32.const 1024))</code></td></tr><tr><td style="text-align:center;"><code>v128.load32_splat</code></td><td style="text-align:center;">加载 32 位整数并复制 4 次填充向量</td><td style="text-align:center;"><code>(v128.load32_splat (i32.const 0x12345678))</code></td></tr><tr><td style="text-align:center;"><code>v128.load64_splat</code></td><td style="text-align:center;">加载 64 位整数并复制 2 次填充向量</td><td style="text-align:center;"><code>(v128.load64_splat (i32.const 0))</code></td></tr><tr><td style="text-align:center;"><code>v128.store offset=&lt;n&gt; align=&lt;m&gt;</code></td><td style="text-align:center;">存储 128 位向量到内存</td><td style="text-align:center;"><code>(v128.store offset=16 align=16 (i32.const 32) (local.get $vec))</code></td></tr><tr><td style="text-align:center;">创建常量</td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;"><code>v128.const &lt;type&gt; &lt;values&gt;</code></td><td style="text-align:center;">创建常量向量</td><td style="text-align:center;"><code>(v128.const i32x4 0 1 2 3)</code></td></tr><tr><td style="text-align:center;"><code>v128.const &lt;type&gt; &lt;values&gt;</code></td><td style="text-align:center;">创建浮点常量向量</td><td style="text-align:center;"><code>(v128.const f32x4 1.0 2.0 3.0 4.0)</code></td></tr><tr><td style="text-align:center;">整数算术运算</td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;"><code>i8x16.add(a, b)</code></td><td style="text-align:center;">8 位整数加法（16 通道）</td><td style="text-align:center;"><code>(i8x16.add (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>i16x8.sub(a, b)</code></td><td style="text-align:center;">16 位整数减法（8 通道）</td><td style="text-align:center;"><code>(i16x8.sub (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>i32x4.mul(a, b)</code></td><td style="text-align:center;">32 位整数乘法（4 通道）</td><td style="text-align:center;"><code>(i32x4.mul (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>i64x2.add(a, b)</code></td><td style="text-align:center;">64 位整数加法（2 通道）</td><td style="text-align:center;"><code>(i64x2.add (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>i8x16.add_saturate_s(a, b)</code></td><td style="text-align:center;">8 位有符号饱和加法</td><td style="text-align:center;"><code>(i8x16.add_saturate_s (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>i16x8.sub_saturate_u(a, b)</code></td><td style="text-align:center;">16 位无符号饱和减法</td><td style="text-align:center;"><code>(i16x8.sub_saturate_u (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;">整数比较运算</td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;"><code>i8x16.eq(a, b)</code></td><td style="text-align:center;">8 位整数相等比较（返回掩码）</td><td style="text-align:center;"><code>(i8x16.eq (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>i32x4.lt_s(a, b)</code></td><td style="text-align:center;">32 位有符号整数小于比较</td><td style="text-align:center;"><code>(i32x4.lt_s (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>i16x8.gt_u(a, b)</code></td><td style="text-align:center;">16 位无符号整数大于比较</td><td style="text-align:center;"><code>(i16x8.gt_u (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;">浮点运算</td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;"><code>f32x4.add(a, b)</code></td><td style="text-align:center;">32 位浮点加法（4 通道）</td><td style="text-align:center;"><code>(f32x4.add (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>f64x2.mul(a, b)</code></td><td style="text-align:center;">64 位浮点乘法（2 通道）</td><td style="text-align:center;"><code>(f64x2.mul (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>f32x4.min(a, b)</code></td><td style="text-align:center;">32 位浮点最小值（4 通道）</td><td style="text-align:center;"><code>(f32x4.min (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>f64x2.sqrt(a)</code></td><td style="text-align:center;">64 位浮点平方根（2 通道）</td><td style="text-align:center;"><code>(f64x2.sqrt (local.get $a))</code></td></tr><tr><td style="text-align:center;">位运算</td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;"><code>v128.and(a, b)</code></td><td style="text-align:center;">按位与</td><td style="text-align:center;"><code>(v128.and (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>v128.or(a, b)</code></td><td style="text-align:center;">按位或</td><td style="text-align:center;"><code>(v128.or (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>v128.xor(a, b)</code></td><td style="text-align:center;">按位异或</td><td style="text-align:center;"><code>(v128.xor (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;"><code>v128.bitselect(a, b, mask)</code></td><td style="text-align:center;">根据掩码选择位</td><td style="text-align:center;"><code>(v128.bitselect (local.get $a) (local.get $b) (local.get $mask))</code></td></tr><tr><td style="text-align:center;">位移</td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;"><code>i32x4.shl(a, imm)</code></td><td style="text-align:center;">32 位整数左移（立即数）</td><td style="text-align:center;"><code>(i32x4.shl (local.get $a) (i32.const 2))</code></td></tr><tr><td style="text-align:center;"><code>i64x2.shr_u(a, imm)</code></td><td style="text-align:center;">64 位无符号整数右移（立即数）</td><td style="text-align:center;"><code>(i64x2.shr_u (local.get $a) (i32.const 3))</code></td></tr><tr><td style="text-align:center;"><code>i16x8.shl(a, imm)</code></td><td style="text-align:center;">16 位整数左移（立即数）</td><td style="text-align:center;"><code>(i16x8.shl (local.get $a) (i32.const 4))</code></td></tr><tr><td style="text-align:center;">通道操作</td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;"><code>i8x16.extract_lane_s(idx, a)</code></td><td style="text-align:center;">提取 8 位有符号整数通道</td><td style="text-align:center;"><code>(i8x16.extract_lane_s 3 (local.get $a))</code></td></tr><tr><td style="text-align:center;"><code>f64x2.replace_lane(idx, a, value)</code></td><td style="text-align:center;">替换 64 位浮点通道</td><td style="text-align:center;"><code>(f64x2.replace_lane 1 (local.get $a) (f64.const 3.14))</code></td></tr><tr><td style="text-align:center;"><code>i8x16.swizzle(a, s)</code></td><td style="text-align:center;">根据索引向量重排通道</td><td style="text-align:center;"><code>(i8x16.swizzle (local.get $a) (local.get $indices))</code></td></tr><tr><td style="text-align:center;"><code>i8x16.shuffle(mask, a, b)</code></td><td style="text-align:center;">根据掩码混洗两个向量的通道</td><td style="text-align:center;"><code>(i8x16.shuffle 0 1 2 3 12 13 14 15 8 9 10 11 4 5 6 7 (local.get $a) (local.get $b))</code></td></tr><tr><td style="text-align:center;">类型转换</td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;"><code>i32x4.trunc_sat_f32x4_s(a)</code></td><td style="text-align:center;">32 位浮点转 32 位有符号整数（饱和截断）</td><td style="text-align:center;"><code>(i32x4.trunc_sat_f32x4_s (local.get $a))</code></td></tr><tr><td style="text-align:center;"><code>f64x2.convert_i32x4_s(a)</code></td><td style="text-align:center;">32 位有符号整数转 64 位浮点</td><td style="text-align:center;"><code>(f64x2.convert_i32x4_s (local.get $a))</code></td></tr><tr><td style="text-align:center;"><code>i16x8.extend_low_i8x16_s(a)</code></td><td style="text-align:center;">将低 8 个 8 位有符号整数扩展为 16 位</td><td style="text-align:center;"><code>(i16x8.extend_low_i8x16_s (local.get $a))</code></td></tr><tr><td style="text-align:center;">其他</td><td style="text-align:center;"></td><td style="text-align:center;"></td></tr><tr><td style="text-align:center;"><code>v128.any_true(a)</code></td><td style="text-align:center;">检查向量中是否有任意通道非零</td><td style="text-align:center;"><code>(v128.any_true (local.get $a))</code></td></tr><tr><td style="text-align:center;"><code>i8x16.all_true(a)</code></td><td style="text-align:center;">检查所有 8 位通道是否全为非零</td><td style="text-align:center;"><code>(i8x16.all_true (local.get $a))</code></td></tr><tr><td style="text-align:center;"><code>f32x4.ceil(a)</code></td><td style="text-align:center;">32 位浮点向上取整</td><td style="text-align:center;"><code>(f32x4.ceil (local.get $a))</code></td></tr><tr><td style="text-align:center;"><code>f64x2.floor(a)</code></td><td style="text-align:center;">64 位浮点向下取整</td><td style="text-align:center;"><code>(f64x2.floor (local.get $a))</code></td></tr></tbody></table><blockquote><p>指令集使用 deepseek 协助汇总，没有严格校对，如有错误请指出。</p></blockquote><h2 id="使用-simd-指令" tabindex="-1">使用 SIMD 指令 <a class="header-anchor" href="#使用-simd-指令" aria-label="Permalink to &quot;使用 SIMD 指令&quot;">​</a></h2><p>举个例子，如果想要对一张图片进行反色处理，如果不使用 SIMD 指令集， wat 实现如下：</p><div class="language-wasm vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wasm</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">module</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;env&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">param</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)))</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ;; 导入内存</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;env&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;memory&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">memory</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ;; 反色函数：原地转换 RGB 通道，跳过Alpha通道</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $invert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $start </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $length </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $end </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">;; 结束地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">;; 当前字节索引</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ;; 计算结束地址 = start + length * 4</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $start</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.mul</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $length) (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.add</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ;; 初始化循环变量 i = start</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $start</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">block</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $exit</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      ;; 主循环（每次处理4个字节：R,G,B,A）</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">loop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $loop</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; 检查是否到达结束地址</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $end</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.ge_u</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        br_if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $exit</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; 处理R通道（偏移0）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.load8_u</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      ;; 加载原始R值</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.sub</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          ;; 计算255 - R</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.store8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       ;; 存储反色后的R值</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; 处理G通道（偏移1）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.add</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.add</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.load8_u</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      ;; 加载原始G值</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.sub</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          ;; 计算255 - G</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.store8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       ;; 存储反色后的G值</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; 处理B通道（偏移2）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.add</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.add</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.load8_u</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      ;; 加载原始B值</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.sub</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">          ;; 计算255 - B</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.store8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       ;; 存储反色后的B值</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; 跳过Alpha通道（偏移3），无需修改</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; 移动到下一个像素（i += 4）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.add</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        br</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $loop</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ;; 导出函数</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;invert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $invert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><p>使用 SIMD 指令，每一步对 1 个像素点 1 个通道的操作会增强为对 4 个像素点 4 个通道的操作：</p><div class="language-wasm vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">wasm</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">module</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;env&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;log&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">param</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;env&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;memory&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">memory</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $invert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $start </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">param</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $length </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $end </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">;; 结束地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">i32</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">;; 当前地址</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $chunk </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">;; 当前处理的16字节</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $mask </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">;; alpha 通道掩码</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">local</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $full255 </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">v128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">;; 全 255 掩码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ;; end = start + length * 4</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $start</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $length</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.mul</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ;; 数据长度可能不是 4 的倍数，这里 +3 确保数据对齐</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.add</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.add</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ;; i = start</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $start</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ;; 常量向量：全 255</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    v128</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i8x16 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                     255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $full255</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ;; 掩码：只保留 alpha 通道（第 3,7,11,15 个字节）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    v128</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i8x16 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                     0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 255</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $mask</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">block</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $exit</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">loop</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $loop</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; if (i &gt;= end) break</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $end</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.ge_u</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        br_if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $exit</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; load 16 bytes (4 pixels)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        v128</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.load</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $chunk</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; tmp = 255 - chunk</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $full255</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $chunk</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i8x16</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.sub</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $chunk</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; 用 bitselect 保留 alpha 通道：</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        v128</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.load</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $chunk</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $mask</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        v128</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.bitselect</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $chunk</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; store back</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $chunk</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        v128</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.store</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ;; i += 16</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 16</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        i32</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.add</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        local</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.set</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $i</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        br</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $loop</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;invert&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">func</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> $invert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br></div></div><p>注意看第 18 到第 20 行，WebAssembly SIMD 指令一次处理 16 字节数据，对应 rgba 4 个通道的图片 4 个像素，每张图片的像素点数量有可能不是 4 的倍数，所以这里加上一个大于 3 的数字即可确保所有数据都可以被处理。但是也要注意，WebAssembly 没有内存守护，这么处理会污染内存，导致其他数据错误，此例功能单一且没有其他数据，这样操作性能最好。</p><p>最后看性能对比：</p><p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/co95os03hng6cnnfqdfd.png" alt="性能对比" loading="lazy"></p><p>上图最左边是素材原图，中间是没有使用 SIMD 指令的处理结果和用时，右边是使用 SIMD 指令的处理结果和用时。素材原图的尺寸为 928*927 ，除了中间的圆形图案以外，其余都是透明像素。可以看到，使用 SIMD 指令的方案性能要比不使用的快 6 倍左右。实际上，素材越大，效果越明显，不过笔者发现在处理更小的图片的场景中，也有显著的提升，比如经典的 lenna 图：</p><p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/12afnhufe7kd0zlnhv6b.png" alt="Image description" loading="lazy"></p><h2 id="预告" tabindex="-1">预告 <a class="header-anchor" href="#预告" aria-label="Permalink to &quot;预告&quot;">​</a></h2><p>下一篇将讨论，C 程序如何在 WebAssembly 中使用 SIMD 。</p></div></div><div class="page-info" data-v-9b6f8dc5><p data-v-9b6f8dc5> 最后更新时间: 2025年09月14日</p><p class="related-tags" data-v-9b6f8dc5 data-v-31b557d0> 标签: <span class="tag-list" data-v-31b557d0><!--[--><span data-v-31b557d0><a href="/tag/WebAssembly" rel="noopener noreferrer" data-v-31b557d0>WebAssembly</a></span><span data-v-31b557d0><a href="/tag/SIMD" rel="noopener noreferrer" data-v-31b557d0>SIMD</a></span><span data-v-31b557d0><a href="/tag/wabt" rel="noopener noreferrer" data-v-31b557d0>wabt</a></span><!--]--></span></p></div></div><div data-v-9b6f8dc5></div><div class="round-button back-to-top" title="回到顶部" data-v-9b6f8dc5 data-v-3bde262c data-v-069854a3><span class="vpi-arrow-up icon" data-v-069854a3></span></div><div class="footer" data-v-9b6f8dc5 data-v-c2b9b91c><p data-v-c2b9b91c> © 2017 ~ 2025 • Yangholmes </p><p class="driver" data-v-c2b9b91c> 使用 ❤️ <a href="https://vitepress.dev/" target="_blank" data-v-c2b9b91c>Vitepress</a> 搭建 - Yangholmes 提供<a href="/renovation-progress" data-v-c2b9b91c>主题</a></p></div></div></main></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"index.md\":\"C7EgsR7Q\",\"renovation-progress.md\":\"Bd0HqZtW\",\"tag_atom.md\":\"biD8W9dV\",\"tag_brainfuck.md\":\"B6f8z-8V\",\"tag_c.md\":\"CgUaB4kD\",\"tag_css.md\":\"CLn0kKHA\",\"tag_emscripten.md\":\"sXZi1AYT\",\"tag_extjs.md\":\"CdZ6eQVH\",\"tag_gdal.md\":\"VfNHc0co\",\"tag_ide.md\":\"DCwiUOOS\",\"tag_javascript.md\":\"BnO-0_L4\",\"tag_map.md\":\"MG223brS\",\"tag_orangepi.md\":\"DTOGMnZx\",\"tag_raspberrypi.md\":\"xvEQqOPa\",\"tag_simd.md\":\"BASPA1K5\",\"tag_typescript.md\":\"DTVD-Xvs\",\"tag_ubuntu.md\":\"rp2G-GNm\",\"tag_vue.md\":\"CelakV9X\",\"tag_wabt.md\":\"DE-O7KO1\",\"tag_wat.md\":\"BsgSr3a6\",\"tag_webassembly.md\":\"Cq-D9Vvv\",\"tag_worker.md\":\"InpOgVia\",\"tag_哲学.md\":\"B5fyUKRS\",\"tag_嵌入式.md\":\"C42iqc4M\",\"tag_本主题.md\":\"DCIMCZzR\",\"tag_浏览器.md\":\"bnMZUBm8\",\"tag_猫.md\":\"CXePa6m6\",\"tag_生活.md\":\"CwuaXA2W\",\"技术的小记_atom 改装指南_index.md\":\"BNMKFA9s\",\"技术的小记_emscripten file system 入门_index.md\":\"DR9V_GHu\",\"技术的小记_extjs 自定义 datetimefield 控件_index.md\":\"ChlPm4JG\",\"技术的小记_google 地图 tms 服务参数解析_index.md\":\"Duugor3x\",\"技术的小记_index.md\":\"DTzz54WD\",\"技术的小记_javascript 变量类型判断_index.md\":\"BPaRGBEp\",\"技术的小记_javascript 隐式转换_index.md\":\"BLcrP5YH\",\"技术的小记_javascript 隐式转换_mermaid.md\":\"Co3d5gy1\",\"技术的小记_javascript 隐式转换_mindmap-en.md\":\"Cuh5DX0C\",\"技术的小记_javascript 隐式转换_mindmap.md\":\"Cj6aNyDm\",\"技术的小记_photoshop 基础--如何抠图_index.md\":\"CSad87aM\",\"技术的小记_wabt 使用小记_index.md\":\"B3oyIIpc\",\"技术的小记_web 应用榨干 cpu 性能的正确姿势_index.md\":\"z7LQKaJX\",\"技术的小记_webassembly 基础（一）_index.md\":\"BOqiRaB1\",\"技术的小记_webassembly 基础（二）_index.md\":\"Du9mhme5\",\"技术的小记_什么是原型链_index.md\":\"Dn_iRSeu\",\"技术的小记_变量声明和作用域_index.md\":\"BggWGDo0\",\"技术的小记_在 webassembly 中使用 simd （一）_index.md\":\"B_oKO_D7\",\"技术的小记_在 webassembly 中使用 simd（二）_index.md\":\"DpN1yn3e\",\"技术的小记_如何为 vue 组件提供 slots 静态类型检查_index.md\":\"CAUxKAvI\",\"技术的小记_如何在 web 应用中使用 gdal （一）_index.md\":\"DXycc_dD\",\"技术的小记_如何在 web 应用中使用 gdal （三）_index.md\":\"CUIzlnN8\",\"技术的小记_如何在 web 应用中使用 gdal （二）_index.md\":\"CzKDm4cs\",\"技术的小记_如何设计一个 brainfuck 解释器_index.md\":\"DDSYtRjl\",\"技术的小记_如何设计一个易用的tag组件_index.md\":\"fUox01hu\",\"技术的小记_浏览器事件循环_index.md\":\"Bu2dKYfh\",\"技术的小记_脚本化css_index.md\":\"D4X65sQp\",\"派的玩耍小记_c 的 main 函数_index.md\":\"BFfhvtvP\",\"派的玩耍小记_gcc 的编译过程_index.md\":\"DllPwUHQ\",\"派的玩耍小记_index.md\":\"CKselgol\",\"派的玩耍小记_orangepi lite 2 刷 ubuntu 18.04.4 方法_index.md\":\"eVFaDaRg\",\"派的玩耍小记_新到的玩具_index.md\":\"C7piUDvX\",\"派的玩耍小记_驱动步进电机_index.md\":\"DS-G7Y8O\",\"生活咏叹调_index.md\":\"B6iciMNd\",\"生活咏叹调_两个和尚的故事_index.md\":\"CwS3r67T\",\"生活咏叹调_我居然想变老_index.md\":\"DCeJPyvD\",\"生活咏叹调_生命_index.md\":\"DxAwBafN\",\"生活咏叹调_生活宝鉴_index.md\":\"CEb9ih_0\",\"生活咏叹调_顽强的绿萝_index.md\":\"XrahRLQ5\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-cn\",\"dir\":\"ltr\",\"title\":\"Yangholmes' blog\",\"description\":\"Yangholmes' blog\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"categories\":[\"技术的小记\",\"派的玩耍小记\",\"生活咏叹调\"],\"posts\":{\"技术的小记\":[{\"title\":\"在 WebAssembly 中使用 SIMD（二）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/在 WebAssembly 中使用 SIMD（二）\",\"createDate\":\"2025/09/09\",\"excerpt\":\"\"},{\"title\":\"在 WebAssembly 中使用 SIMD （一）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/在 WebAssembly 中使用 SIMD （一）\",\"createDate\":\"2025/09/08\",\"excerpt\":\"\"},{\"title\":\"wabt 使用小记\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/wabt 使用小记\",\"createDate\":\"2025/09/04\",\"excerpt\":\"\"},{\"title\":\"WebAssembly 基础（二）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/WebAssembly 基础（二）\",\"createDate\":\"2025/09/02\",\"excerpt\":\"\"},{\"title\":\"EMSCRIPTEN File System 入门\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/EMSCRIPTEN File System 入门\",\"createDate\":\"2025/08/26\",\"excerpt\":\"\"},{\"title\":\"如何在 web 应用中使用 GDAL （三）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何在 web 应用中使用 GDAL （三）\",\"createDate\":\"2025/08/18\",\"excerpt\":\"\"},{\"title\":\"JavaScript 隐式转换\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/JavaScript 隐式转换\",\"createDate\":\"2025/08/13\",\"excerpt\":\"\"},{\"title\":\"如何在 web 应用中使用 GDAL （二）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何在 web 应用中使用 GDAL （二）\",\"createDate\":\"2025/08/10\",\"excerpt\":\"\"},{\"title\":\"如何在 web 应用中使用 GDAL （一）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何在 web 应用中使用 GDAL （一）\",\"createDate\":\"2025/08/04\",\"excerpt\":\"\"},{\"title\":\"JavaScript 变量类型判断\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/JavaScript 变量类型判断\",\"createDate\":\"2025/07/12\",\"excerpt\":\"\"},{\"title\":\"如何为 Vue 组件提供 slots 静态类型检查\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何为 Vue 组件提供 slots 静态类型检查\",\"createDate\":\"2025/05/28\",\"excerpt\":\"\"},{\"title\":\"WebAssembly 基础（一）\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/WebAssembly 基础（一）\",\"createDate\":\"2024/06/21\",\"excerpt\":\"\"},{\"title\":\"google 地图 TMS 服务参数解析\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/google 地图 TMS 服务参数解析\",\"createDate\":\"2023/08/17\",\"excerpt\":\"\"},{\"title\":\"浏览器事件循环\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/浏览器事件循环\",\"createDate\":\"2023/05/22\",\"excerpt\":\"\"},{\"title\":\"变量声明和作用域\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/变量声明和作用域\",\"createDate\":\"2022/08/21\",\"excerpt\":\"\"},{\"title\":\"web 应用榨干 CPU 性能的正确姿势\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/web 应用榨干 CPU 性能的正确姿势\",\"createDate\":\"2021/09/03\",\"excerpt\":\"\"},{\"title\":\"什么是原型链\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/什么是原型链\",\"createDate\":\"2021/01/13\",\"excerpt\":\"\"},{\"title\":\"Atom 改装指南\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/Atom 改装指南\",\"createDate\":\"2018/06/22\",\"excerpt\":\"\"},{\"title\":\"如何设计一个 BrainFuck 解释器\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何设计一个 BrainFuck 解释器\",\"createDate\":1526860800000,\"excerpt\":\"\"},{\"title\":\"如何设计一个易用的tag组件\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/如何设计一个易用的tag组件\",\"createDate\":1526342400000,\"excerpt\":\"\"},{\"title\":\"PhotoShop 基础--如何抠图\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/PhotoShop 基础--如何抠图\",\"createDate\":\"2016/06/04\",\"excerpt\":\"\"},{\"title\":\"脚本化CSS\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/脚本化CSS\",\"createDate\":\"2016/05/09\",\"excerpt\":\"\"},{\"title\":\"ExtJS 自定义 datetimefield 控件\",\"category\":\"技术的小记\",\"url\":\"/技术的小记/ExtJS 自定义 datetimefield 控件\",\"createDate\":\"2016/05/07\",\"excerpt\":\"\"}],\"派的玩耍小记\":[{\"title\":\"OrangePi Lite 2 刷 Ubuntu 18.04.4 方法\",\"category\":\"派的玩耍小记\",\"url\":\"/派的玩耍小记/OrangePi Lite 2 刷 Ubuntu 18.04.4 方法\",\"createDate\":\"2020/05/03\",\"excerpt\":\"\"},{\"title\":\"驱动步进电机\",\"category\":\"派的玩耍小记\",\"url\":\"/派的玩耍小记/驱动步进电机\",\"createDate\":\"2019/11/23\",\"excerpt\":\"\"},{\"title\":\"C 的 main 函数\",\"category\":\"派的玩耍小记\",\"url\":\"/派的玩耍小记/C 的 main 函数\",\"createDate\":\"2019/10/27\",\"excerpt\":\"\"},{\"title\":\"gcc 的编译过程\",\"category\":\"派的玩耍小记\",\"url\":\"/派的玩耍小记/gcc 的编译过程\",\"createDate\":\"2019/10/27\",\"excerpt\":\"\"},{\"title\":\"新到的玩具\",\"category\":\"派的玩耍小记\",\"url\":\"/派的玩耍小记/新到的玩具\",\"createDate\":1572019200000,\"excerpt\":\"\"}],\"生活咏叹调\":[{\"title\":\"生活宝鉴\",\"category\":\"生活咏叹调\",\"url\":\"/生活咏叹调/生活宝鉴\",\"createDate\":\"2021/05/09\",\"excerpt\":\"\"},{\"title\":\"两个和尚的故事\",\"category\":\"生活咏叹调\",\"url\":\"/生活咏叹调/两个和尚的故事\",\"createDate\":\"2021/02/26\",\"excerpt\":\"\"},{\"title\":\"顽强的绿萝\",\"category\":\"生活咏叹调\",\"url\":\"/生活咏叹调/顽强的绿萝\",\"createDate\":\"2020/11/19\",\"excerpt\":\"\"},{\"title\":\"生命\",\"category\":\"生活咏叹调\",\"url\":\"/生活咏叹调/生命\",\"createDate\":\"2020/11/18\",\"excerpt\":\"\"},{\"title\":\"我居然想变老\",\"category\":\"生活咏叹调\",\"url\":\"/生活咏叹调/我居然想变老\",\"createDate\":\"2020/11/17\",\"excerpt\":\"\"}]},\"lastUpdated\":true,\"page\":{\"backToTop\":true,\"comment\":true,\"relatedTags\":true},\"search\":{\"provider\":\"local\"},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/Yangholmes\"},{\"icon\":\"dev\",\"link\":\"https://dev.to/yangholmes\"},{\"icon\":\"instagram\",\"link\":\"https://www.instagram.com/yangholmes/\"},{\"icon\":\"wechat\",\"link\":\"/wechat-qrcode.png\"}]},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  <script type="text/javascript">
          (function(c,l,a,r,i,t,y){
              c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
              t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
              y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
          })(window, document, "clarity", "script", "sqwvxx7phf");
        </script></body>
</html>